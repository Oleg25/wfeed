<?phpheader('Content-Type: application/xml');define('ERROR_PIK','<station name="pik"><comment>ошибка от yr.no</comment></station>');define('ERROR_Plato','<station name="plato"><comment>ошибка от yr.no</comment></station>');            $D1 =  date('Y-m-d', strtotime(' + 1 days'));			$D2 =  date('Y-m-d', strtotime(' + 2 days'));			$D3 =  date('Y-m-d', strtotime(' + 3 days'));			$from_d1_1 = $D1."T07:00:00";			$from_d1_2 = $D1."T19:00:00";			$to_d1_1 = $D1."T13:00:00";			$to_d1_2 = $D2."T01:00:00";						$from_d2_1 = $D2."T16:00:00";			$from_d2_2 = $D2."T19:00:00";			$to_d2_1 = $D2."T22:00:00";			$to_d2_2 = $D3."T01:00:00";							function clear_w($str){           return preg_replace('/[\+\s]*/', '', $str);          }				  function get_data($url){                  $cURL = curl_init();				        //curl_setopt($cURL, CURLOPT_PROXYTYPE, 'HTTP');                        //curl_setopt($cURL, CURLOPT_PROXY, "192.168.110.222:8080");                        //curl_setopt($cURL, CURLOPT_PROXYUSERPWD, "rskh\velmisov_oo:12345vV");						curl_setopt($cURL, CURLOPT_URL, $url);												curl_setopt($cURL, CURLOPT_TIMEOUT, 30);						curl_setopt($cURL, CURLOPT_FAILONERROR, true);						curl_setopt($cURL, CURLOPT_HEADER, 0);						curl_setopt($cURL, CURLOPT_RETURNTRANSFER, 1);						$data = curl_exec($cURL);						curl_close($cURL);						return $data;					} 	  function get_between_tags($input, $start_t, $end_t){				 if (preg_match_all('/'.$start_t.'(.*)'.$end_t.'/Usi', $input, $arr, PREG_PATTERN_ORDER)) {				  	 					    		$result = "<station name='Rosa Pik'>\n<time p='7-13'>".$arr[1][0]."<comment></comment>\n</station>\n"."<station name='Rosa Plato'>\n<time p='7-13'>".$arr[1][1]."<comment></comment>\n</station>"; //perl style                    					}				    else $result = "error";				     return $result;		   		 }                 					 				$aibga = get_data("http://www.yr.no/place/Russia/Krasnodar/Khrebet_Aibga/forecast.xml");			$plato = get_data("http://www.yr.no/place/Russia/Krasnodar/Urochishche_Roza/forecast.xml");			$data_f = $aibga.$plato;														    $foo = get_between_tags($data_f,'<time from="'.$from_d1_1.'" to="'.$to_d1_1.'" period="1">','<time from="'.$from_d2_1.'" to="'.$to_d2_1.'" period="3">');			if ($foo =='error') {$foo =  get_between_tags($data_f,'<time from="'.$from_d1_1.'" to="'.$to_d1_1.'" period="1">','<time from="'.$from_d2_2.'" to="'.$to_d2_2.'" period="3">');}			else if ($foo =='error') $foo = ERROR_Pik;			$full = "<yr_no>\n".$foo."\n</yr_no>";										 			    $doc = DOMDocument::loadXML($full);								$xpath1 = new DOMXPath($doc);								 $sky = $xpath1->query('//time/symbol');				 $wind = $xpath1->query('//time/windSpeed');				 $wind_dir = $xpath1->query('//time/windDirection');				 $temp = $xpath1->query('//time/temperature');				         foreach($sky as $result){                              				 				 $sky_t = $result->getAttribute('name');				  switch ($sky_t) {				  				  case "Fair" :				  $sky_t = "SUNNY";				  $sky_id = "1";				  break;				  				  case "Partly cloudy" :				  $sky_t = "PARTLY SUNNY";				  $sky_id = "2";				  break;				  				  case "Rain" :				  $sky_t = "RAIN";				  $sky_id = "4";				  break;				  				  case "Cloudy" :				  $sky_t = "CLOUDY";				  $sky_id = "3";				  break;				  				  case "Snow" :				  $sky_t = "SNOW";				  $sky_id = "5";				  break;				  				  case "Storm" :				  $sky_t = "STORM";				  $sky_id = "6";				  break;				  				  default:				  $sky_t = $result->getAttribute('name');				  				  				   } 				 				 $result->setAttribute("name",$sky_t);				 $result->setAttribute("id",$sky_id);		      } 		        											foreach($wind as $result2){                             				 				 $wind_t = $result2->getAttribute("mps");                 				 				 $result2->setAttribute("mps",round($wind_t,0));		          } 				  			foreach($wind_dir as $result4){                             				 				 $wind_dir = $result4->getAttribute("code");                 				 				 $result4->setAttribute("code",substr($wind_dir,0,2));		          }						 foreach($temp as $result3){                             				 				 $temp_t = $result3->getAttribute("value");				                  				 				 $result3->setAttribute("value",$temp_t);		      }		   		   print substr($doc->saveXML(),22);					    		?>